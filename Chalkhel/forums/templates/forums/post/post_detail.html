{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container rounded bg-white mt-5 mb-5">
    <div class="row bg-light">
        <div class="col-md-3 px-0 border rounded overflow-hidden bg-white">
            <div class="d-flex flex-column align-items-center text-center pb-5 position-relative">
              <img class="img-fluid mb-5 pb-3" src="https://blog.getbootstrap.com/assets/img/2020/06/v5-new-logo.png">
              <img style="top: 115px;" class="rounded-circle border position-absolute " width="100" height="100" src="https://getbootstrap.com/docs/5.0/assets/brand/bootstrap-social-logo.png">
              <!-- <img style="top: 115px;" class="rounded-circle border position-absolute " width="100" height="100" src="{{ profile.profile_pic }}"> -->
              <span class="font-weight-bold">{{profile.user}}</span>

            </div>
        </div>
        <div class="col-md-8 border-right">
          <!-- <ul class="nav border rounded">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="{% url 'my-profile' %}">Posts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'my-profile-comments' %}">Comments</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'my-profile-voted-posts' %}">Votes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'my-profile-hidden-posts' %}" tabindex="-1">Hidden</a>
            </li>
        </ul> -->

<div class="card bg-white">
  <div class="card-body">
    <span class="form-text fw-light">
      <img class="rounded-circle border" width="20" height="20" src="https://getbootstrap.com/docs/5.0/assets/brand/bootstrap-social-logo.png">
      <b>
        <a href="{{post.owner.profiles.get_absolute_url}}">
          {{object.owner}}
        </a>
      </b> - Posted on: {{ object.created }}
    </span>
    <h5 class="card-title pb-2">{{ object.name }}</h5>
    <p class="card-text">
      {{ object.body }}
    </p>

    {% if object.media_content%}
    {% if object.media_content_type == 0 %}
    <div class="text-center">
      <a href="{{object.media_content.url}}">
        <img src="{{object.media_content.url}}" class="img-fluid" alt="">
      </a>
    {% elif object.media_content_type == 1 %}
      <video class="img-fluid" controls>
         <source src="{{object.media_content.url}}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
    {% endif %}
    {% endif %}

    <ul class="nav border rounded mt-2">

      {% if request.user.is_authenticated %}

      {% if object.voted == True %}

        {% if object.vote_type == True %}
          <li class="nav-item">
            <form action="{% url 'forums_vote_delete' pk=object.vote_id %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="1">
              <input type="hidden" name="post" value="{{ object.id }}">
              <button type="submit" class="nav-link active">Liked</button>
            </form>
          </li>

          <li class="nav-item">
            <form action="{% url 'forums_vote_update' pk=object.vote_id %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="0">
              <input type="hidden" name="post" value="{{ object.id }}">
              <button type="submit" class="nav-link active">Dislike</button>
            </form>
          </li>
        {% endif %}

        {% if object.vote_type == False %}
        <li class="nav-item">
          <form action="{% url 'forums_vote_update' pk=object.vote_id %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="vote_type" value="1">
            <input type="hidden" name="post" value="{{ object.id }}">
            <button type="submit" class="nav-link active">Like</button>
          </form>
        </li>

          <li class="nav-item">
            <form action="{% url 'forums_vote_delete' pk=object.vote_id %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="1">
              <input type="hidden" name="post" value="{{ object.id }}">
              <button type="submit" class="nav-link active">Disliked</button>
            </form>
          </li>

        {% endif %}

      {% else %}
        <li class="nav-item">
          <form action="{% url 'forums_post_vote_create' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="vote_type" value="1">
            <input type="hidden" name="object_id" value="{{ object.id }}">
            <button type="submit" class="nav-link active">Like</button>
          </form>
        </li>

        <li class="nav-item">
          <form action="{% url 'forums_post_vote_create' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="vote_type" value="0">
            <input type="hidden" name="object_id" value="{{ object.id }}">
            <button type="submit" class="nav-link active">Dislike</button>
          </form>
        </li>
      {% endif %}
      {% endif %}
      <li class="nav-item">
        <a class="nav-link" href="{% url 'my-profile-voted-posts' %}">Save</a>
      </li>
      {% if object.owner.id == request.user.id %}
      <li class="nav-item">
      <a class="nav-link" href="{% url 'forums_post_update' slug=object.slug %}" tabindex="-1">Edit</a>
    </li>
      {% endif %}
  </ul>

  <div class="mt-2" style="width:100%;"></div>
  <form action="{% url 'forums_comment_create' %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="post" value="{{object.id}}">
    <textarea id="summernote" name="body" style="width:100%;"></textarea>
    <div class="d-grid gap-2">
      <button class="btn btn-primary my-1" type="submit">Submit</button>
    </div>
  </form>

  {% for comment in comments %}
    <div class="card-body text-start">
      <span class="form-text fw-light">
        <img class="rounded-circle border" width="20" height="20" src="https://getbootstrap.com/docs/5.0/assets/brand/bootstrap-social-logo.png">
          <a href="{{profile.get_absolute_url}}" class="fs-6">
            {{comment.owner}}
          </a>
            - commented on: {{ comment.created }}
      </span>
      <p class="card-text fs-6 my-2">{{ comment.body }}</p>
      <ul class="nav border rounded mt-2">
        {% if request.user.is_authenticated %}
        {% if comment.voted == True %}

          {% if comment.vote_type == True %}
            <li class="nav-item">
              <form action="{% url 'forums_vote_delete' pk=comment.vote_id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="vote_type" value="1">
                <input type="hidden" name="post" value="{{ comment.id }}">
                <button type="submit" class="nav-link active">Liked</button>
              </form>
            </li>

            <li class="nav-item">
              <form action="{% url 'forums_vote_update' pk=comment.vote_id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="vote_type" value="0">
                <input type="hidden" name="post" value="{{ comment.id }}">
                <button type="submit" class="nav-link active">Dislike</button>
              </form>
            </li>
          {% endif %}

          {% if comment.vote_type == False %}
          <li class="nav-item">
            <form action="{% url 'forums_vote_update' pk=comment.vote_id %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="1">
              <input type="hidden" name="post" value="{{ comment.id }}">
              <button type="submit" class="nav-link active">Like</button>
            </form>
          </li>

            <li class="nav-item">
              <form action="{% url 'forums_vote_delete' pk=comment.vote_id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="vote_type" value="1">
                <input type="hidden" name="post" value="{{ comment.id }}">
                <button type="submit" class="nav-link active">Disliked</button>
              </form>
            </li>

          {% endif %}

        {% else %}
          <li class="nav-item">
            <form action="{% url 'forums_comment_vote_create' %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="1">
              <input type="hidden" name="object_id" value="{{ comment.id }}">
              <button type="submit" class="nav-link active">Like</button>
            </form>
          </li>

          <li class="nav-item">
            <form action="{% url 'forums_comment_vote_create' %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="vote_type" value="0">
              <input type="hidden" name="object_id" value="{{ comment.id }}">
              <button type="submit" class="nav-link active">Dislike</button>
            </form>
          </li>
        {% endif %}
        {% endif %}
        {% if comment.owner.id == request.user.id %}
        <li class="nav-item">
          <a class="nav-link" href="{% url 'forums_comment_update' slug=comment.slug %}" tabindex="-1">Edit</a>
        </li>
        {% endif %}
    </ul>
    </div>
  {% endfor %}
  </div>
</div>
</div>
</div>
</div>
</div>

<script>
    $(document).ready(function() {
        $('#summernote').summernote({
          placeholder: 'write your comment here...',
          toolbar: [
            // [groupName, [list of button]]
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['font', ['strikethrough', 'superscript', 'subscript']],
            ['fontsize', ['12']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['height', ['height']],
            ['insert', ['link']],
          ]
        });
    });
  </script>
{% endblock %}
